* 2016-11-13
** Followed ROS tuto on docker: https://hub.docker.com/_/ros/
** ping android to/from ubuntu on aws
- install ZeroTier
  curl -s https://install.zerotier.com/ | bash
- create ZeroTier account, create new network
- check IPV4 auto-assign
sudo zerotier-cli join 565799d8f6f7f87f 
- install ZeroTier on Android, join network
- On the Website https://my.zerotier.com/network/565799d8f6f7f87f, check 'auth' on each member, and give them a good name
- let's ping
  ping 10.242.58.128 # from ubuntu
  ping 10.242.116.228 # from android
** ROS pub/sub from android to ubuntu
*** Android:
- Run local master node
- use auto IP address
 
*** Ubuntu:
docker run -it --rm  --name master ros:indigo-perception bash
export ROS_MASTER_URI=http://10.242.58.128:11311
rostopic list
# /camera/compressed !!!
#docker run --expose 11311 -it --rm     --net foo     --name master     ros:ros-tutorials     roscore
rosrun image_view image_view image:=/camera/compressed
# Doesn't work !! Docker must use X11
** Image view from a docker image
http://toddsampson.com/post/131965350342/ros-visualization-packages-in-docker
mkdir -p ~/ros/image-view
vim Dockerfile
docker build --tag ros:indigo-image-pipeline .
vim docker-compose.yml
# Paste website's compose and change ROS_MASTER_URI

*** TODO does not work !! Try another docker image that runs firefox: http://fabiorehm.com/blog/2014/09/11/running-gui-apps-with-docker/

* 2016-11-18
  - got some trouble with Ubuntu running from NoMachine: it is hanging
  - it could have been caused by the disk being full at some point yesterday, or by ros writing to X, or by the hostname renaming ?
  - recreated a new machine from snapshot with 20Gb
  - re-installed ZeroTier
  - ran the docker firefox image, OK !
  - Ran ros-image-pipeline/docker-compose up => displays an X Window, but no image :-(
  - this works:
  #+BEGIN_SRC bash
  docker build -t ros-image-pipeline .
  docker run -it --rm -e ROS_MASTER_URI=http://10.242.58.128:11311 ros-image-pipeline 
  rostopic list
  #+END_SRC
  - next step: investigate network issues: http://wiki.ros.org/ROS/NetworkSetup
* 2016-11-19
** setup dnsmasq
#+BEGIN_SRC bash 
sudo apt install dnsmasq
vim /etc/dnsmasq.conf
interfaces=eth0 
:wq

vim /etc/hosts 
Ga
10.242.58.128 ev3
52.51.247.240 aws
:wq

sudo systemctl enable dnsmasq
ping aws
ping ev3 
nslookup ev3 aws

# On Android: change wifi settings to setup DNS
ping ev3 
ping aws
#+END_SRC  
** checked network connectivity http://wiki.ros.org/ROS/NetworkSetup
#+BEGIN_SRC bash
# Ubuntu
nc -l -p 1234
# Android on SSHDroid
echo hello from ev3|nc aws 1234
nc -l -p 1234
# Ubuntu
echo hello from aws |nc ev3 1234
#+END_SRC

** tried the image_view again:
#+BEGIN_SRC bash
docker run --dns 52.51.247.240 -it --rm -v /tmp/.X11-unix:/tmp/.X11-unix -e ROS_MASTER_URI=http://ev3:11311 ros-image-pipeline
rostopic list
rosrun image_view image_view image:=/camera/compressed
# No image :-(
rostopic echo /camera/compressed
# Unable to register with master node [http://ev3:11311]: master may not be running yet. Will keep trying.
#+END_SRC
The problem is that the android box cannot connect back to the docker container, the port is not open, and we need some routing !
There might be a solution with MacVLAN: http://blog.oddbit.com/2014/08/11/four-ways-to-connect-a-docker/

* 2016-11-20
** MacVLan
- on ZeroTier, check 'bridge' checkbox on the AWS ubuntu host
#+BEGIN_SRC bash
docker network create -d macvlan --subnet=10.242.0.0/16  -o parent=zt0 rosnet
docker run --dns 52.51.247.240 --net rosnet -it --rm -v /tmp/.X11-unix:/tmp/.X11-unix -e ROS_MASTER_URI=http://ev3:11311 ros-image-pipeline
ping www.google.fr # does not work :-(
ping ev3 # does not work
ping 10.242.58.128  # ip of the android phone, works !!
ping 10.242.119.232 # ip of ubuntu laptop at home, works !!
#+END_SRC
- all I need to do now is to specify the right gateway, but how can I get a gateway on the ZeroTier network ? Maybe with iptables ?
